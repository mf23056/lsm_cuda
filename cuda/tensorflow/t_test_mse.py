# 再度ライブラリをインポート
import numpy as np
from scipy import stats
import matplotlib.pyplot as plt

# MSE_random と MSE_balance のデータを numpy 配列に格納
mse_random = np.array([
    1.825328712575625e+19, 0.019640382083226878, 1.8941207032665014e+19, 0.014469540975418214,
    1.8765438254934847e+19, 0.016757831755814377, 0.013941338460091317, 0.014376569841899408,
    0.016310359207754387, 0.015052627431245318, 0.01580897867494507, 0.017504492906937785,
    1.4929019362397383e+19, 0.015387156976411007, 0.015397639670138054, 0.015538950872374722,
    2.664482342865351e+19, 2.8021043601934356e+19, 0.015729113083437166, 0.0169453778730637,
    0.014112639549507923, 0.01543596635945444, 0.015074165729972671, 0.015342631721271493,
    0.014970286320452652, 0.014388587847786505, 0.013976903353198464, 0.015052826206756086,
    0.015327555571759485, 2.3364042868498297e+19, 2.206953818465947e+19, 0.0145651644879423,
    0.01570784462350131, 0.015250176974172667, 1.600697745944065e+19, 0.014756281506599103,
    2.8561582968508367e+19, 0.015071340860554295, 1.5833267109894939e+19, 1.6213232738853046e+19,
    0.015179107316689177, 2.569938785254679e+19, 0.013826679575834047, 1.1585431006361797e+19,
    0.015542496529400842, 0.014872376479498519, 0.015376777149277229, 0.01688320590325675,
    0.015391299689337785, 0.014925292039631728, 0.01491426585732928, 0.015661699476457028,
    0.015015770697684377, 1.7079745943858334e+19, 0.01602534553404168, 0.014875806446753953,
    0.01515168239674183, 3.469864176019194e+18, 2.311243139454369e+19, 0.01493919408595816,
    0.01486906287793268, 3.928640258997137e+19, 0.01580567379455524, 2.350674911885014e+19,
    0.015658179657263665, 0.01726039200197493, 0.015629713157306862, 0.015248365012485627,
    0.015504402551205693, 0.014882857574504976, 0.015477245020092175, 9.24195997390124e+18,
    0.016334956948903665, 2.465793702627326e+19, 6.176294088157678e+18, 1.9575825915688428e+19,
    0.014975206180840552, 0.015013903101793779, 0.013772874869575822
])

mse_balance = np.array([
    0.013665102800289687, 0.015719615438449765, 1.9396227050696598e+19, 0.013719455666942361,
    0.01585213845877736, 0.01527523608828179, 0.01552444158168255, 0.014014937681698064,
    2.278025309004928e+17, 0.01571306292348976, 0.01391487898699645, 0.01405490692429368,
    0.01458184049830291, 0.01572723044083584, 0.0158796646841594, 0.015785340772155067,
    0.013321135566058386, 0.015875475435864848, 0.015903594346864072, 2.7340436798688707e+19,
    0.014132633474370403, 4.4205368228541194e+18, 0.014775367200923619, 0.01572880320048423,
    7.351404588776801e+18, 0.015399148100783447, 0.015209299612864238, 0.016364877549598592,
    0.013857168798321023, 0.015070191046376396, 0.015522373037490187, 0.015920577043727617,
    0.015035991484177029, 0.015607237141219383, 0.016036436948133722, 0.01573902767821959,
    0.014751099693532131, 0.01310676338932485, 0.014266737840472834, 2.9068004486697914e+19,
    0.014576291736670459, 0.01556755368515416, 0.014574686830938452, 0.016098603481575133,
    0.014363336189459366, 0.015643322662900815, 0.015530670545134921, 0.01505826502999259,
    0.014888486887317075, 0.015583256261389337, 0.015728105068494345, 0.015086353743642025,
    0.015303101345056854, 0.015992389942323916, 0.015459359021150235, 0.01501572056767813,
    0.01597740449748109, 0.014606862936005398, 0.015191953610012158, 3.2231286063299592e+19,
    0.014709826036610313, 0.01519981074485694, 0.015079271208558566, 2.7430399936037024e+19,
    2.438627803413677e+19, 0.015472326781696893, 0.015689502231761587, 0.016138283054151333,
    0.015328764578279794, 0.013717984891650672, 1.6825395162771102e+19, 0.01521722716792398,
    0.014772921970397136, 0.015324989844227895, 0.014991588217984455, 0.014859341309400122,
    0.015076899926071863, 0.016700329460524747, 0.015204445049977519
])

# 外れ値除去（MSEが1.0以上のデータを削除）
def remove_outliers_threshold(data, threshold=1.0):
    return data[data < threshold]

mse_random_filtered = remove_outliers_threshold(mse_random)
mse_balance_filtered = remove_outliers_threshold(mse_balance)

# t検定の実施
t_stat_filtered, p_value_filtered = stats.ttest_ind(mse_random_filtered, mse_balance_filtered, equal_var=False)

# 結果を表示
t_stat_filtered, p_value_filtered
